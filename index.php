<?phprequire "sys/generator.php";require "sys/uiconstants.php";// Contains the data about the player civilizationclass Player {	const Name = "Alonian";	const Sys = "Alon";}?><html>   <head>      <title>Testing</title>      <link rel="stylesheet" type="text/css" href="css/dastyle.css" />      <script src="js/lib/jquery-1.8.3.min.js"></script>      <script src="js/core.js"></script>      <script src="js/world.js"></script>      <script src="sys/ui.php"></script>      <script>              <?php defCreateUniverse(Player::Name, Player::Sys); ?>                // Make sure they are global explicitally        var uni = createUniverse();        var player = uni.civs.get("<?php echo Player::Name; ?>");                var starmap = new ui.Starmap(uni, player.home.sysName);        var selships = new core.Hashtable();        var systemView = new ui.SystemView(uni);                // Does this work?        function getMousePos(canvas, e) {            var rect = canvas.getBoundingClientRect();            return {                x: e.clientX - rect.left,                y: e.clientY - rect.top            };        }        // Setups the game        $(function() {            $('#<?php echo UIStatic::CivInfo; ?>').html(player.civName + ' ' + player.type);            starmap.draw(player, canvas());            updateUI();                        // Hide the system view            $('#<?php echo UIStatic::SystemView; ?>').hide();                        // Add event handlers            $('#<?php echo UIStatic::Starmap ?>').click(displayStarmap);            $('#<?php echo UIStatic::System ?>').click(displaySystem);            $('#<?php echo UIStatic::Diplomacy ?>').click(displayDiplomacy);            $('#<?php echo UIStatic::Colonies ?>').click(displayColonies);            $('#<?php echo UIStatic::Ships ?>').click(displayShips);            $('#<?php echo UIStatic::Research ?>').click(displayResearch);                        // Add the event handlers to the starmap            var starmapId = '#<?php echo UIStatic::StarmapView; ?>';            $(starmapId).mousemove(highlightSys);            $(starmapId).click(selectSys);            $(starmapId).dblclick(function() {                if (starmap.highlighted() === uni.sys(starmap.selected)) {                    displaySystem();                }            });            starmap.selectionChanged = function(sys) {                ui.updateShipBar(player, $('#<?php echo UIStatic::BottomDisp; ?>'), sys, selectShip, showShipData);            };                       // Close HUD             $(".close").click(function(e) {                $("#hud").hide();            });        });                // Selects or deselects ships        function selectShip(id) {            // Get the ship and make sure its owned by the player            var ship = uni.sys(starmap.selected).ships.get(id);            if (ship.owner === player) {                // Select it if it wasnt selected, or deselect it if it was                var uiship = $('#' + ui.shipId(id));                if (uiship.hasClass('activeShip') == true) {                    uiship.removeClass('activeShip');                    selships.remove(id);                }                else {                    uiship.addClass('activeShip');                    selships.put(id, ship);                }            }        }                // Highlights a system        function highlightSys(e) {            var c = canvas();            var mp = getMousePos(c, e);            if (starmap.highlight(c, mp.x, mp.y)) {                starmap.draw(player, c);            }        }                // Selects a system        function selectSys(e) {            // If a system was highlighted, select it            var sys = starmap.highlighted();            if (sys !== null) {                // If one or more ships was selected, ask if they should be sent to the system                if (!selships.isEmpty() && confirm('Send the ships?')) {                    var ships = selships.values();                    uni.sys(starmap.selected).leave(ships);                    sys.enter(ships);                    selships.clear();                    player.visit(sys)                }                                // Select the system and redraw the starmap                starmap.select(player, sys.sysName);                starmap.draw(player, canvas());            }        }                // Returns the canvas        function canvas() {            return document.getElementById('<?php echo UIStatic::StarmapView; ?>');        }        // Updates the UI        function updateUI() {            $('#<?php echo UIStatic::MoneyInfo; ?>').html(player.money);            ui.updateShipBar(player, $('#<?php echo UIStatic::BottomDisp; ?>'), uni.sys(starmap.selected), selectShip, showShipData);        }        // Displays the starmap        function displayStarmap() {            $('#<?php echo UIStatic::SystemView; ?>').hide();            $('#<?php echo UIStatic::StarmapView; ?>').show();            starmap.draw(player, canvas());        }        // Displays a system        function displaySystem() {            $('#<?php echo UIStatic::StarmapView; ?>').hide();            var view = $('#<?php echo UIStatic::SystemView; ?>').show();            systemView.display(player, view, starmap.selected);        }                // NOT IMPLEMENTED STUFF BELLOW        function displayDiplomacy() {            alert("Not implemented yet");        }                function displayColonies() {            alert("Not implemented yet");        }                function displayShips() {            alert("Not implemented yet");        }                function displayResearch() {            alert("Not implemented yet");        }                function endTurn() {            alert("Not implemented yet");        }                // Shows the ship data        function showShipData(uid) {            var ship = uni.sys(starmap.selected).ships.get(uid);            $("#hudShipType").html(ship.type);            $("#hudShipHull").html(ship.health + " / " + ship.maxHealth);            $("#hudShipRange").html(ship.range);            $("#hudShipDamage").html(ship.damage === 0 ? "N/A" : ship.damage);            $("#hudShipOwner").html(ship.owner.civName + " " + ship.owner.type);            $("#hud").show();        }            </script>   </head>   <body>        <!-- The HUD -->        <div id="hud">            <div id="info_central">                <div class="close">X</div>                <p id="hudShipType"></p>                <div>Hull: <span id="hudShipHull"></span></div>                <div>Range: <span id="hudShipRange"></span></div>                <div>Damage: <span id="hudShipDamage"></span></div>                <div>Owner: <span id="hudShipOwner"></span></div>            </div>        </div>                <!-- Top data and button bar thing -->        <div class="header">            <span id="<?php echo UIStatic::CivInfo; ?>"></span> -             <span id="<?php echo UIStatic::MoneyInfo; ?>"></span> bc -             <button id="<?php echo UIStatic::Starmap; ?>" type="button">Galaxy</button>             <button id="<?php echo UIStatic::System; ?>" type="button">System</button>             <button id="<?php echo UIStatic::Diplomacy; ?>" type="button">Diplomacy</button>             <button id="<?php echo UIStatic::Colonies; ?>" type="button">Colonies</button>             <button id="<?php echo UIStatic::Ships; ?>" type="button">Ships</button>             <button id="<?php echo UIStatic::Research; ?>" type="button">Research</button>         </div>        <!-- The content -->        <div class="content">            <div id="<?php echo UIStatic::SystemView; ?>">            </div>            <canvas id="<?php echo UIStatic::StarmapView; ?>" class="starmap">            </canvas>        </div>         <!-- The bottom menu bar thing -->        <div id="footer" class="footer">           <div id="<?php echo UIStatic::BottomDisp; ?>"></div>           <!-- The end turn button -->           <button id="<?php echo UIStatic::EndTurn; ?>" class="endturn" type="button" onclick="endTurn();">End turn</button>        </div>   </body></html>